<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrazione - Hairplan</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <header class="bg-dark text-white text-center py-4">
        <h1>Registrati su Hairplan</h1>
    </header>

    <main class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <form id="registerForm" class="p-4 border rounded shadow">
                    <h2 class="text-center mb-4">Crea un account</h2>

                    <div class="mb-3">
                        <label class="form-label">Registrati come:</label><br>
                        <input type="radio" id="user" name="accountType" value="user" checked>
                        <label for="user">Utente</label>
                        <input type="radio" id="hairdresser" name="accountType" value="hairdresser">
                        <label for="hairdresser">Parrucchiere</label>
                    </div>

                    <div id="userFields">
                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="username" name="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="age" class="form-label">Età</label>
                            <input type="number" class="form-control" id="age" name="age" required>
                        </div>
                    </div>

                    <div id="hairdresserFields" style="display: none;">
                        <div class="mb-3">
                            <label for="parrucchiere_username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="parrucchiere_username"
                                name="parrucchiere_username" required>
                        </div>
                        <div class="mb-3">
                            <label for="parrucchiere_nome" class="form-label">Nome</label>
                            <input type="text" class="form-control" id="parrucchiere_nome" name="parrucchiere_nome"
                                required>
                        </div>
                        <div class="mb-3">
                            <label for="parrucchiere_cognome" class="form-label">Cognome</label>
                            <input type="text" class="form-control" id="parrucchiere_cognome"
                                name="parrucchiere_cognome" required>
                        </div>
                        <div class="mb-3">
                            <label for="parrucchiere_email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="parrucchiere_email" name="parrucchiere_email"
                                required>
                        </div>
                        <div class="mb-3">
                            <label for="parrucchiere_telefono" class="form-label">Telefono</label>
                            <input type="text" class="form-control" id="parrucchiere_telefono"
                                name="parrucchiere_telefono" required>
                        </div>
                        <div class="mb-3">
                            <label for="parrucchiere_nome_salone" class="form-label">Nome Salone</label>
                            <input type="text" class="form-control" id="parrucchiere_nome_salone"
                                name="parrucchiere_nome_salone" required>
                        </div>
                        <div class="mb-3">
                            <label for="parrucchiere_indirizzo" class="form-label">Indirizzo</label>
                            <input type="text" class="form-control" id="parrucchiere_indirizzo"
                                name="parrucchiere_indirizzo" required>
                        </div>
                        <div class="mb-3">
                            <label for="parrucchiere_servizi_offerti" class="form-label">Servizi Offerti</label>
                            <input type="text" class="form-control" id="parrucchiere_servizi_offerti"
                                name="parrucchiere_servizi_offerti" required>
                        </div>
                        <div class="mb-3">
                            <label for="parrucchiere_descrizione" class="form-label">Descrizione</label>
                            <input type="text" class="form-control" id="parrucchiere_descrizione"
                                name="parrucchiere_descrizione" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Registrati</button>
                </form>
                <div class="text-center mt-3">
                    <a href="index.html" class="btn btn-secondary">Torna al login</a>
                </div>
                <div id="registerMessage" class="mt-3"></div>
            </div>
        </div>
    </main>
    <br>
    <footer class="bg-dark text-white text-center py-4 mt-5">
        <p>&copy; 2024 Hairplan. Tutti i diritti riservati.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const userFields = document.getElementById('userFields');
        const hairdresserFields = document.getElementById('hairdresserFields');

        userFields.style.display = 'block';
        hairdresserFields.style.display = 'none';

        // Rendi i campi dell'utente richiesti
        document.getElementById('username').required = true;
        document.getElementById('email').required = true;
        document.getElementById('age').required = true;

        // Rimuovi il required dai campi del parrucchiere
        document.getElementById('parrucchiere_username').required = false;
        document.getElementById('parrucchiere_nome').required = false;
        document.getElementById('parrucchiere_cognome').required = false;
        document.getElementById('parrucchiere_email').required = false;
        document.getElementById('parrucchiere_telefono').required = false;
        document.getElementById('parrucchiere_nome_salone').required = false;
        document.getElementById('parrucchiere_indirizzo').required = false;
        document.getElementById('parrucchiere_servizi_offerti').required = false;
        document.getElementById('parrucchiere_descrizione').required = false;
        document.querySelectorAll('input[name="accountType"]').forEach((elem) => {
            elem.addEventListener('change', function (event) {
                if (event.target.value === 'hairdresser') {
                    userFields.style.display = 'none';
                    hairdresserFields.style.display = 'block';

                    // Rendi i campi del parrucchiere richiesti
                    document.getElementById('parrucchiere_username').required = true;
                    document.getElementById('parrucchiere_nome').required = true;
                    document.getElementById('parrucchiere_cognome').required = true;
                    document.getElementById('parrucchiere_email').required = true;
                    document.getElementById('parrucchiere_telefono').required = true;
                    document.getElementById('parrucchiere_nome_salone').required = true;
                    document.getElementById('parrucchiere_indirizzo').required = true;
                    document.getElementById('parrucchiere_servizi_offerti').required = true;
                    document.getElementById('parrucchiere_descrizione').required = true;

                    // Rimuovi il required dai campi dell'utente
                    document.getElementById('username').required = false;
                    document.getElementById('email').required = false;
                    document.getElementById('age').required = false;
                } else {
                    userFields.style.display = 'block';
                    hairdresserFields.style.display = 'none';

                    // Rendi i campi dell'utente richiesti
                    document.getElementById('username').required = true;
                    document.getElementById('email').required = true;
                    document.getElementById('age').required = true;

                    // Rimuovi il required dai campi del parrucchiere
                    document.getElementById('parrucchiere_username').required = false;
                    document.getElementById('parrucchiere_nome').required = false;
                    document.getElementById('parrucchiere_cognome').required = false;
                    document.getElementById('parrucchiere_email').required = false;
                    document.getElementById('parrucchiere_telefono').required = false;
                    document.getElementById('parrucchiere_nome_salone').required = false;
                    document.getElementById('parrucchiere_indirizzo').required = false;
                    document.getElementById('parrucchiere_servizi_offerti').required = false;
                    document.getElementById('parrucchiere_descrizione').required = false;
                }
            });
        });


        document.getElementById('registerForm').addEventListener('submit', async (event) => {
            event.preventDefault(); // Previene l'invio del modulo

            const accountType = document.querySelector('input[name="accountType"]:checked').value;
            const userData = {};

            if (accountType === 'user') {
                userData.username = document.getElementById('username').value;
                userData.email = document.getElementById('email').value;
                userData.age = document.getElementById('age').value;
            } else {
                userData.username = document.getElementById('parrucchiere_username').value;
                userData.nome = document.getElementById('parrucchiere_nome').value;
                userData.cognome = document.getElementById('parrucchiere_cognome').value;
                userData.email = document.getElementById('parrucchiere_email').value;
                userData.telefono = document.getElementById('parrucchiere_telefono').value;
                userData.nome_salone = document.getElementById('parrucchiere_nome_salone').value;
                userData.indirizzo = document.getElementById('parrucchiere_indirizzo').value;
                userData.servizi_offerti = document.getElementById('parrucchiere_servizi_offerti').value;
            }

            const password = document.getElementById('password').value;
            const apiEndpoint = accountType === 'user' ? 'http://135.181.35.51:3000/utenti' : 'http://135.181.35.51:3000/parrucchieri';

            // Aggiungi la password ai dati dell'utente
            userData.pass = password;
            console.log(userData);
            try {
                const response = await fetch(apiEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData),
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log(result)
                    document.getElementById('registerMessage').innerHTML = `<div class="alert alert-success">${result.message}</div>`;

                    if (accountType === 'hairdresser') {
                        // Creazione del calendario con descrizione
                        const calendarData = {
                            nome: userData.nome_salone,       // Usa il nome del salone per il campo 'nome' del calendario
                            descrizione: document.getElementById('parrucchiere_descrizione').value, // Usa 'descrizione' come richiesto
                            parrucchiere_id: result.id             // ID dell'utente appena creato
                        };

                        // Richiesta per creare il calendario
                        await fetch('http://135.181.35.51:3000/calendari', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(calendarData),
                        });

                        document.getElementById('registerMessage').innerHTML += `<div class="alert alert-success">Calendario creato per il parrucchiere!</div>`;
                    }

                    // Reindirizza alla pagina di login
                    window.location.href = 'index.html'; // Redirige a login dopo 2 secondi

                } else {
                    const error = await response.json();
                    document.getElementById('registerMessage').innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
                }
            } catch (error) {
                console.error('Errore durante la registrazione:', error);
                document.getElementById('registerMessage').innerHTML = `<div class="alert alert-danger">Errore durante la registrazione. Riprova più tardi.</div>`;
            }
        });
    </script>
    <style>
        /* CSS per il footer sempre in fondo */
        html,
        body {
            height: 100%;
            margin: 0;
        }

        body {
            display: block;
        }

        main {
            min-height: calc(100vh - 100px);
        }

        footer {
            position: fixed;
            bottom: 0;
            width: 100%;
        }
    </style>
</body>

</html>